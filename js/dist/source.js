$(function(){function r(){var e=window.location.hash;return e=e.substr(1).length==0?0:isNaN(e.substr(1))?0:parseInt(e.substr(1)),e}function i(e){var n=$.trim($("#search").val()).toLowerCase();n=n.length?"/search/"+n:"",xhr&&xhr.readyState!=4&&xhr.abort(),xhr=$.ajax({url:t+"page/"+e+"/length/"+page_length+n,type:"get",dataType:"json",async:!1,success:function(t){render_view(t.result_set,e),render_paginator(t.count[0],e),total_records=t.count[0],s()}})}function s(){$("table tbody tr").find("input:checkbox:checked").length?$("#delete_selected").hasClass("disabled")&&$("#delete_selected").removeClass("disabled"):($("#delete_selected").hasClass("disabled")||$("#delete_selected").addClass("disabled"),$("table thead input:checkbox").attr("checked",!1))}var e=$("#base_path").text(),t=e+"service/",n=r();$(window).on("hashchange",function(e){n=r(),i(n)}),$("table").delegate(".delete","click",function(){var e=$(this);return $("#deleteModal").find("#title_con").text(e.parents("tr").find("#title_record").text()),$("#deleteModal").find("#artist_con").text(e.parents("tr").find("#artist_record").text()),$("#deleteModal").find("#id").val(e.data("id")),$("#deleteModal").modal("show"),!1}),$("table").delegate(".update","click",function(){var e=$(this);return $("#updateModal").find("#title_update").val(e.parents("tr").find("#title_record").text()),$("#updateModal").find("#artist_update").val(e.parents("tr").find("#artist_record").text()),$("#updateModal").find("#id").val(e.data("id")),$("#updateModal").modal("show"),!1}),$("table tbody").delegate("input:checkbox","click",function(){s()}),$("#search").keyup(function(){i(0)}),$("#add_btn").click(function(){var e=$.trim($("#title").val()),r=$.trim($("#artist").val());e&&r&&$.ajax({url:t,data:{title:e,artist:r},type:"post",dataType:"json",success:function(e){e.response==200?(i(n),$("#title").val(""),$("#artist").val("")):alert(e.message)}})}),$("#delete_btn").click(function(){var e=$("#deleteModal").find("#id").val();$.ajax({url:t,data:{id:e},type:"delete",dataType:"json",success:function(e){e.response==200?(i(n),$("#deleteModal").modal("hide")):alert(e.message)}})}),$("#update_btn").click(function(){var e=$("#updateModal").find("#id").val(),r=$("#updateModal").find("#title_update").val(),s=$("#updateModal").find("#artist_update").val();r&&s&&$.ajax({url:t+"id/"+e,data:{title:r,artist:s},type:"put",dataType:"json",success:function(e){e.response==200?(i(n),$("#updateModal").modal("hide")):alert(e.message)}})}),$("#delete_selected").click(function(){ids=[],$("table tbody tr").find("input:checkbox").each(function(e,t){var n=$(t);n.attr("checked")&&ids.push(n.val())}),ids.length&&($("#deleteSelectedModal").find(".modal-body").html("<p>Are you sure you want to delete those selected record(s)?<p>"),$("#deleteSelectedModal").modal("show"))}),$("#delete_selected_btn").click(function(){var e=0;ids.length&&$.each(ids,function(n,r){$.ajax({url:t,data:{id:r},type:"delete",dataType:"json",async:!1,success:function(t){t.response==200&&e++}})}),ids.length==e?(i(n),$("#deleteSelectedModal").modal("hide")):alert("Internal error.")}),$("#check_all").click(function(){var e=$(this);e.attr("checked")?$("table tr").find("input:checkbox").attr("checked",!0):$("table tr").find("input:checkbox").attr("checked",!1),s()}),i(n)});